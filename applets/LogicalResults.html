<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>Inside J2VM Interactive Illustrations - Logical Results</TITLE>
<META NAME="description" content="Logical Results (Java applet) - A
simulation of the Java virtual machine.">
<META NAME="keywords" content="Java Virtual Machine, Java logical operations">
<META NAME="author" content="Bill Venners">
</HEAD>
<!--BEGIN_ARTIMA_COLOR_SCHEME-->
<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#000099" VLINK="#009999" ALINK="#CC0000">
<!--END_ARTIMA_COLOR_SCHEME-->
<!--BEGIN_FISH_HEADING--> 
<CENTER>
<IMG src="images/fishhead.gif" alt="Interactive Illustrations for Inside the
Java 2 Virtual Machine">
</CENTER>
<!--END_FISH_HEADING--> 
<!--BEGIN_MAIN_TITLES-->
<FONT face="arial, helvetica" COLOR="#000066">
<FONT size=6>Logical Results</FONT><BR>
<FONT size=3>A Simulation of the Java Virtual Machine</FONT><BR>
</FONT>
<!--END_MAIN_TITLES-->
<!--BEGIN_TITLE_UNDERBAR-->
<HR align="left" width="85%">
<!--END_TITLE_UNDERBAR-->
<!--BEGIN_RIGHT_MARGIN_TABLE_TAG-->
<TABLE CELLPADDING="3" CELLSPACING="0" BORDER="0" width="85%">
<TR>
<TD  valign="top" rowspan="100">
<!--END_RIGHT_MARGIN_TABLE_TAG-->
<!--BEGIN_MAIN_BODY-->
<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="PrimeTime.html">Previous</A>&nbsp;| 
<A href="InnerFloat.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->


<p>The <i>Logical Results</i> applet, included below, demonstrates a Java virtual machine executing a sequence of bytecodes. This applet accompanies Chapter 13, &quot;Logic,&quot; of <i>Inside the Java 2 Virtual Machine</i>.</p>

<p><center><applet CODE="LogicalResults.class" ARCHIVE="JVMSims.jar"
CODEBASE="JVMSimulators" WIDTH=600 HEIGHT=370><b>For some reason, your browser won't let you view this way cool Java applet.</b></applet></center></p>

<p>The bytecode sequence in the simulation was generated by <code>javac</code> for the <code>incrementLogically()</code> method of the <code>VulcanCounter</code> class:
</p>
<pre>
// On CD-ROM in file opcodes/ex1/VulcanCounter.java
class VulcanCounter {

    static void incrementLogically() {
        int spock = 0;
        for (;;) {
            int tempSpock = spock;
            for (int i = 0; i < 32; ++i) {
                int mask = 0x1 << i;
                if ((tempSpock & mask) == 0) {
                    tempSpock |= mask;  // Change 0 to 1
                    break;
                }
                else {
                    tempSpock &= ~mask; // Change 1 to 0
                }
            }
            spock = tempSpock;
        }
    }
}
</pre>
<p>The bytecodes generated by <code>javac</code> for <code>incrementLogically()</code> are:
</p>
<pre>
 0 iconst_0     // Push int constant 0.
 1 istore_0     // Pop to local variable 0: int spock = 0;
 2 iload_0      // Push local variable 0 (spock).
 3 istore_1     // Pop to local variable 1: int tempSpock = spock;
 4 iconst_0     // Push int constant 0.
 5 istore_2     // Pop to local variable 2: int i = 0;
 6 goto 35      // Jump unconditionally ()
 9 iconst_1     // Push int constant 1.
10 iload_2      // Push local variable 2 (i).
11 ishl         // Arithmetic shift left top int (i) by next
                // to top int (1).
12 istore_3     // Pop to local variable 3: int mask = i << 0x1;
13 iload_1      // Push local variable 1 (tempSpock).
14 iload_3      // Push local variable 3 (mask).
15 iand         // Bitwise AND top two ints: (spock & mask)
16 ifne 26      // Jump if top of stack is not equal to zero:
                // if ((spock & mask) == 0) {
19 iload_1      // Push local variable 1 (tempSpock).
20 iload_3      // Push local variable 3 (mask).
21 ior          // Bitwise OR top two ints (tempSpock | mask)
22 istore_1     // Pop to local variable 1: tempSpock |= mask;
23 goto 41      // Jump unconditionally (to just after
                // inner for): break;
26 iload_1      // Push local variable 1 (tempSpock).
27 iload_3      // Push local variable 3 (mask).
28 iconst_m1    // Push -1.
29 ixor         // Bitwise EXCLUSIVE-OR top two ints: ~mask
30 iand         // Bitwise AND top two ints: tempSpock & (~mask)
31 istore_1     // Pop to local variable 1: tempSpock &= ~mask;
32 iinc 2 1     // Increment local variable 2 by 1: ++i
35 iload_2      // Push local variable 2 (i).
36 bipush 32    // Push integer constant 32.
38 if_icmplt 9  // Jump (to top of inner for) if "next to top"
                // integer is less than "top" integer: i < 32
41 iload_1      // Push local variable 1 (tempSpock)
42 istore_0     // Pop to local variable 0: spock = tempSpock;
43 goto 2       // Jump unconditionally (to top of outer for).
</pre>
<p>The <code>incrementLogically()</code> method repeatedly increments an <code>int</code> without using the <code>+</code> or <code>++</code> operators. It uses only the logical operators: <code>&</code>, <code>|</code>, and <code>~</code>. An increment is accomplished by searching through the bits of the current <code>int</code>, starting with the lowest order bit, and turning ones to zeros. As soon as a zero is encountered in the current <code>int</code>, it is changed to one and the search stops. The resultant <code>int</code> now represents the old <code>int</code> incremented by one. The process is started again on the new <code>int</code>. Each incremented number is stored in the <code>spock</code> variable. <code>spock</code> is local variable zero in the compiled bytecodes, so you can watch local variable zero count 0, 1, 2, 3, and so on.
</p>
<p>To drive the <i>Logical Results</i> simulation, use the Step, Reset, Run, and Stop buttons. Each time you press the Step button, the simulator will execute the instruction pointed to by the pc register. If you press the Run button, the simulation will continue with no further coaxing on your part until you press the Stop button. To start the simulation over, press the Reset button. For each step of the simulation, a panel at the bottom of the applet contains an explanation of what the next instruction will do. Happy clicking.
</p>

<p><HR WIDTH=500></p>
<p>
Click here to view a page of links to the <a href="sourcecode.html#jvmsim">source code</a> of the <i>Logical Results</i> applet.
</p>


<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="PrimeTime.html">Previous</A>&nbsp;| 
<A href="InnerFloat.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->
<!--END_MAIN_BODY-->
<!--BEGIN_RIGHT_MARGIN_TABLE_CLOSE-->
</TD>
</TR>
</TABLE>
<!--END_RIGHT_MARGIN_TABLE_CLOSE-->
<!--BEGIN_FOOTER_SEPARATOR-->
<HR width="100%">
<!--END_FOOTER_SEPARATOR-->
<!--BEGIN_FOOTER-->
<TABLE width="100%">
<TR>
<TD align="left">
<FONT size="1" face="geneva, arial, sans-serif">
<!--REG_COPYRIGHT_LINE--><A href="copyright.html">Copyright</A> &copy; 1996-1999 Bill Venners. All Rights Reserved.
</FONT>
</TD>
</TR>
</TABLE>
<!--END_FOOTER-->
</body>
</html>
