<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>Inside J2VM Interactive Illustrations - Prime Time</TITLE>
<META NAME="description" content="Prime Time (Java applet) - A
simulation of the Java virtual machine.">
<META NAME="keywords" content="Java Virtual Machine, calculating prime numbers">
<META NAME="author" content="Bill Venners">
</HEAD>
<!--BEGIN_ARTIMA_COLOR_SCHEME-->
<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#000099" VLINK="#009999" ALINK="#CC0000">
<!--END_ARTIMA_COLOR_SCHEME-->
<!--BEGIN_FISH_HEADING--> 
<CENTER>
<IMG src="images/fishhead.gif" alt="Interactive Illustrations for Inside the
Java 2 Virtual Machine">
</CENTER>
<!--END_FISH_HEADING--> 
<!--BEGIN_MAIN_TITLES-->
<FONT face="arial, helvetica" COLOR="#000066">
<FONT size=6>Prime Time</FONT><BR>
<FONT size=3>A Simulation of the Java Virtual Machine</FONT><BR>
</FONT>
<!--END_MAIN_TITLES-->
<!--BEGIN_TITLE_UNDERBAR-->
<HR align="left" width="85%">
<!--END_TITLE_UNDERBAR-->
<!--BEGIN_RIGHT_MARGIN_TABLE_TAG-->
<TABLE CELLPADDING="3" CELLSPACING="0" BORDER="0" width="85%">
<TR>
<TD  valign="top" rowspan="100">
<!--END_RIGHT_MARGIN_TABLE_TAG-->
<!--BEGIN_MAIN_BODY-->
<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="InnerInt.html">Previous</A>&nbsp;| 
<A href="LogicalResults.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->


<p>The <i>Prime Time</i> applet, included below, demonstrates a Java virtual machine executing a sequence of bytecodes that generates prime numbers. This applet accompanies Chapter 12, &quot;Integer Arithmetic,&quot; of <i>Inside the Java 2 Virtual Machine</i>.</p>

<p><center><applet CODE="PrimeTime.class" ARCHIVE="JVMSims.jar"
CODEBASE="JVMSimulators" WIDTH=600 HEIGHT=360><b>For some reason, your browser won't let you view this way cool Java applet.<br> (Apparently, your browser is not ready for Prime Time.)</b></applet></center></p>

<p> The bytecode sequence in the simulation was generated by the <code>javac</code> compiler for the <code>findPrimes()</code> method of the class shown below:
</p>
<pre>
// On CD-ROM in file integer/ex1/PrimeFinder.java
class PrimeFinder {

    static void findPrimes() {
        
        int primeNum = 1;
        int numToCheck = 2;

        for (;;) {

            boolean foundPrime = true;

            for (int divisor = numToCheck / 2; divisor > 1;
                --divisor) {

                if (numToCheck % divisor == 0) {
                    foundPrime = false;
                    break;
                }
            }

            if (foundPrime) {
                primeNum = numToCheck;
            }

            ++numToCheck;
        }
    }
}
</pre>
<p>The <code>findPrimes()</code> method places prime numbers, one at a time and in increasing numerical order, into the <code>primeNum</code> variable. To find the primes, the <code>findPrimes()</code> method checks each positive integer in increasing numerical order starting with integer value two. It keeps the current number it is checking in the <code>numToCheck</code> variable. The outer for loop, a &quot;forever&quot; loop, keeps this process going indefinitely. To check a number, it divides the number by smaller integers and looks for a zero remainder. If it encounters a zero remainder, then the number has integral factors other than one and itself and therefore isn't prime. 
</p>
<p>For each number to check, the <code>findPrimes()</code> method divides the number by two. The result of this integer division is the first value checked as a possible integral divisor for the number.
</p>
<p>In the inner for loop, the <code>findPrimes()</code> method tries each number as a divisor between the result of the division by two and the divisor two. If the remainder of any of these divisions is zero, it breaks out of the inner for loop and skips to the next number to check. If it reaches divisor two and has found no divisor that yields a zero remainder, it has found the next prime number. It exits the inner for loop and sets <code>primeNum</code> equal to the number to check.
</p>
<p>For example, when <code>numToCheck</code> is 10, <code>findPrimes()</code> first divides 10 by 2 to get the first divisor, 5. It then performs the remainder operation on 10 and 5 and discovers a zero remainder. So it breaks out of the inner for loop and sets <code>numToCheck</code> to 11. (It doesn't ever set <code>primeNum</code> to 10.) It divides 11 by 2 to get the first divisor to check, once again 5. It performs the remainder operation on 11 and integers 5, 4, 3, and 2, none of which yield a zero remainder. It completes the inner for loop, sets <code>primeNum</code> equal to 11, and continues on to check 12.
</p>
<p>The bytecodes generated by <code>javac</code> for the <code>findPrimes()</code> method are shown below:
</p>
<pre>
 0 iconst_1      // Push int constant 1
 1 istore_0      // Pop into local var 0: int primeNum = 1;
 2 iconst_2      // Push int constant 2
 3 istore_1      // Pop into local var 1: int numToCheck = 2;

// The outer for loop (the "forever" loop) begins here:
 4 iconst_1      // Push int constant 1
 5 istore_2      // Pop into local var 2: boolean foundPrime = true;

// The inner for loop begins here. First, initialize divisor.
 6 iload_1       // Push int in local var 1 (numToCheck)
 7 iconst_2      // Push int constant 2
 8 idiv          // Pop two ints, divide them, push int result
                 // Pop int into local var 3:
9 istore_3       // int divisor = numToCheck / 2;

// Next, test the inner for loop's termination condition
10 goto 27       // Jump to for loop condition check

// The body of the inner for loop begins here.
13 iload_1       // Push the int in local var 1 (numToCheck)
14 iload_3       // Push the int in local var 3 (divisor)
15 irem          // Pop two ints, remainder them, push result
                 // Pop int, jump if equal to zero:
16 ifne 24       // if (numToCheck % divisor == 0)
19 iconst_0      // Push int constant 0
20 istore_2      // Pop into local var 2: foundPrime = false;
21 goto 32       // Jump out of inner for loop

// At this point, the body of the inner for loop is done. Now just
// perform the third statement of the for expression: decrement
// divisor.
24 iinc 3 -1     // Increment local var 3 by -1: --divisor

// The test for the inner for loop's termination condition
// begins here. This loop will keep on looping while (divisor > 1).
27 iload_3       // Push int from local var 3 (divisor)
28 iconst_1      // Push int constant 1
29 if_icmpgt 13  // Pop top two ints, jump if greater than

// At this point, the inner for loop has completed. Next check
// to see if a prime number was found.
32 iload_2       // Push int from local var 2 (foundPrime)
33 ifeq 38       // Pop top int, jump if zero: if (foundPrime) {
36 iload_1       // Push int from local var 1 (numToCheck)
37 istore_0      // Pop into local var 0: primeNum = numToCheck;
38 iinc 1 1      // Increment local var 1 by 1: ++numToCheck;
41 goto 4        // Jump back to top of outer for loop.
</pre>
<p>The <code>javac</code> compiler placed local variable <code>primeNum</code> from the source into local variable slots 0 on the stack frame. It put <code>numToCheck</code> into slot 1, <code>foundPrime</code> into slot 2,  and <code>divisor</code> into slot 3. As mentioned above, as this method finds each successive prime number, it places the number into the <code>primeNum</code> variable. As you run the simulation, therefore, you will see the prime numbers appear sequentially in the <code>int</code> value stored in local variable slot 0.
</p>
<p>One thing to note about this bytecode sequence is that it demonstrates the way in which <code>boolean</code>s from Java source code are treated on the stack frame by Java bytecodes. The value stored in local variable slot 2, which represents the <code>boolean</code> <code>foundPrime</code> variable from the source, is an <code>int</code>. It is set to <code>true</code> or <code>false</code> by instructions that push a constant <code>int</code> zero or one. Its boolean value is checked by instructions that compare an <code>int</code> against zero.
</p>
<p>Another thing to note about this simulation is that eventually the <code>numToCheck</code> value will overflow. When it does, the virtual machine will throw no exceptions. It will just continue executing the <code>findPrimes()</code> method with <code>int</code> values that no longer hold any relationship to the prime numbers.
</p>
<p>To drive the <i>Prime Time</i> simulation, use the Step, Reset, Run, and Stop buttons. Each time you press the Step button, the simulator will execute the instruction pointed to by the pc register. If you press the Run button, the simulation will continue with no further coaxing on your part until you press the Stop button. To start the simulation over, press the Reset button. For each step of the simulation, a panel at the bottom of the applet contains an explanation of what the next instruction will do. Happy clicking.
</p>

<p><HR WIDTH=500></p>
<p>
Click here to view a page of links to the <a href="sourcecode.html#jvmsim">source code</a> of the <i>Prime Time</i> applet.
</p>


<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="InnerInt.html">Previous</A>&nbsp;| 
<A href="LogicalResults.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->
<!--END_MAIN_BODY-->
<!--BEGIN_RIGHT_MARGIN_TABLE_CLOSE-->
</TD>
</TR>
</TABLE>
<!--END_RIGHT_MARGIN_TABLE_CLOSE-->
<!--BEGIN_FOOTER_SEPARATOR-->
<HR width="100%">
<!--END_FOOTER_SEPARATOR-->
<!--BEGIN_FOOTER-->
<TABLE width="100%">
<TR>
<TD align="left">
<FONT size="1" face="geneva, arial, sans-serif">
<!--REG_COPYRIGHT_LINE--><A href="copyright.html">Copyright</A> &copy; 1996-1999 Bill Venners. All Rights Reserved.
</FONT>
</TD>
</TR>
</TABLE>
<!--END_FOOTER-->
</body>
</html>
