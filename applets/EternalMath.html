<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>Inside J2VM Interactive Illustrations - Eternal Math</TITLE>
<META NAME="description" content="Eternal Math (Java applet) - A
simulation of the Java virtual machine.">
<META NAME="keywords" content="Java Virtual Machine, Java bytecodes">
<META NAME="author" content="Bill Venners">
</HEAD>
<!--BEGIN_ARTIMA_COLOR_SCHEME-->
<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#000099" VLINK="#009999" ALINK="#CC0000">
<!--END_ARTIMA_COLOR_SCHEME-->
<!--BEGIN_FISH_HEADING--> 
<CENTER>
<IMG src="images/fishhead.gif" alt="Interactive Illustrations for Inside the 
Java 2 Virtual Machine">
</CENTER>
<!--END_FISH_HEADING--> 
<!--BEGIN_MAIN_TITLES-->
<FONT face="arial, helvetica" COLOR="#000066">
<FONT size=6>Eternal Math</FONT><BR>
<FONT size=3>A Simulation of the Java Virtual Machine</FONT><BR>
</FONT>
<!--END_MAIN_TITLES-->
<!--BEGIN_TITLE_UNDERBAR-->
<HR align="left" width="85%">
<!--END_TITLE_UNDERBAR-->
<!--BEGIN_RIGHT_MARGIN_TABLE_TAG-->
<TABLE CELLPADDING="3" CELLSPACING="0" BORDER="0" width="85%">
<TR>
<TD  valign="top" rowspan="100">
<!--END_RIGHT_MARGIN_TABLE_TAG-->
<!--BEGIN_MAIN_BODY-->
<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="introduction.html">Previous</A>&nbsp;| 
<A href="GettingLoaded.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->


<p>The <i>Eternal Math</i> applet, included below, simulates a Java virtual machine executing a few bytecode instructions. This applet accompanies Chapter 5, &quot;The Java Virtual Machine, &quot; of <i>Inside the Java 2 Virtual Machine</i>.</p>

<p><center><applet CODE="EternalMath.class" ARCHIVE="JVMSims.jar"
CODEBASE="JVMSimulators" WIDTH=600 HEIGHT=360><b>For some reason, your browser won't let you view this way cool Java applet.</b></applet></center></p>

<p>
The instructions in the simulation were generated by the <code>javac</code> compiler
given the following code:</p>

<pre>// On CD-ROM in file jvm/ex4/Act.java
class Act {

    public static void doMathForever() {
        int i = 0;
        for (;;) {
            i += 1;
            i *= 2;
        }
    }
}</pre>
<p>Here are the bytecodes generated by <code>javac</code> for class <code>Act</code>:</p>
<pre> 
0   iconst_0           // Push int constant 0.
1   istore_0           // Pop into local variable 0: int i = 0;
2   iinc 0, 1          // Increment local variable 0 by 1: i += 1;
5   iload_0            // Push int in local variable 0
6   iconst_2           // Push int constant 2
7   imul               // Pop two ints, multiply, push result
8   istore_0           // Pop into local variable 0: i *= 2;
9   goto 2             // Jump unconditionally to 2: for (;;) {}</pre>

<p>The instructions in the simulation represent the body of the <CODE>doMathForever()</CODE> method of class <CODE>Act</CODE>, shown above. This simulation shows the local variables and operand stack of the current frame, the pc register, and the bytecodes in the method area.
It also shows an optop register, which you can think of as part of the frame data of this particular implementation of the Java virtual machine. The optop register always points to one word beyond the top of the operand stack. 
</p>
<p>The applet has four buttons: Step, Reset, Run, and Stop. Each time you press the Step button, the Java virtual machine simulator will execute the instruction pointed to by the pc register. Initially, the pc register points to an <CODE>iconst_0</CODE> instruction. The first time you press the Step button, therefore, the virtual machine will execute <CODE>iconst_0</CODE>. It will
push a zero onto the stack and set the pc register to point to the next instruction to execute. Subsequent presses of the Step button will execute subsequent instructions and the pc register will lead the way. If you press the Run button, the simulation will continue with no further coaxing on your part until you press the Stop button. To start the simulation over, press the Reset button.
</p>
<p>The value of each register (pc and optop) is shown two ways. The contents of each register, an integer offset from the beginning of either the method's bytecodes or the operand stack, is shown in an edit box. Also, a small arrow (either "pc>" or "optop>") indicates the location contained in the register.
</p>
<p>In the simulation the operand stack is shown growing down the panel (up in memory offsets) as words are pushed onto it. The top of the stack recedes back up the panel as words are popped from it.
</p>
<p>The <CODE>doMathForever()</CODE> method has only one local variable, <CODE>i</CODE>, which sits at array position zero. The first two instructions, <CODE>iconst_0</CODE> and <CODE>istore_0</CODE> initialize the local variable to zero. The next instruction, <CODE>iinc</CODE>, increments <CODE>i</CODE> by one. This instruction implements the <CODE>i += 1</CODE> statement from <CODE>doMathForever()</CODE>. The next instruction, <CODE>iload_0</CODE>, pushes
the value of the local variable onto the operand stack. <CODE>iconst_2</CODE> pushes an <CODE>int</CODE> 2 onto the operand stack. <CODE>imul</CODE> pops the top two <CODE>ints</CODE> from the operand stack, multiplies them, and pushes the result. The <CODE>istore_0</CODE> instruction pops the result of the multiply and puts it into the local variable. The previous four instructions implement the <CODE>i *= 2</CODE> statement from <CODE>doMathForever()</CODE>. The last instruction, <CODE>goto</CODE>, sends the program counter back to the <CODE>iinc</CODE> 
</p>
<p>With enough patience and clicks of the Step button (or a long enough run of the Run button), you can get an arithmetic overflow. When the Java virtual machine encounters such a condition, it just truncates, as is shown by this simulation. It does not throw any exceptions.
</p>
<p>For each step of the simulation, a panel at the bottom of the applet contains an explanation of what the next instruction will do. Happy clicking.</p>

<p><HR WIDTH=500></p>
<p>
Click here to view a page of links to the <a href="sourcecode.html#jvmsim">source code</a> of the <i>Eternal Math</i> applet.
</p>


<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="introduction.html">Previous</A>&nbsp;| 
<A href="GettingLoaded.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->
<!--END_MAIN_BODY-->
<!--BEGIN_RIGHT_MARGIN_TABLE_CLOSE-->
</TD>
</TR>
</TABLE>
<!--END_RIGHT_MARGIN_TABLE_CLOSE-->
<!--BEGIN_FOOTER_SEPARATOR-->
<HR width="100%">
<!--END_FOOTER_SEPARATOR-->
<!--BEGIN_FOOTER-->
<TABLE width="100%">
<TR>
<TD align="left">
<FONT size="1" face="geneva, arial, sans-serif">
<!--REG_COPYRIGHT_LINE--><A href="copyright.html">Copyright</A> &copy; 1996-1999 Bill Venners. All Rights Reserved.
</FONT>
</TD>
</TR>
</TABLE>
<!--END_FOOTER-->
</body>
</html>
