<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>Inside J2VM Interactive Illustrations - Three Dimensional Array</TITLE>
<META NAME="description" content="Three Dimensional Array (Java applet) - A
simulation of the Java virtual machine.">
<META NAME="keywords" content="Java Virtual Machine, Java arrays">
<META NAME="author" content="Bill Venners">
</HEAD>
<!--BEGIN_ARTIMA_COLOR_SCHEME-->
<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#000099" VLINK="#009999" ALINK="#CC0000">
<!--END_ARTIMA_COLOR_SCHEME-->
<!--BEGIN_FISH_HEADING--> 
<CENTER>
<IMG src="images/fishhead.gif" alt="Interactive Illustrations for Inside the
Java 2 Virtual Machine">
</CENTER>
<!--END_FISH_HEADING--> 
<!--BEGIN_MAIN_TITLES-->
<FONT face="arial, helvetica" COLOR="#000066">
<FONT size=6>Three Dimensional Array</FONT><BR>
<FONT size=3>A Simulation of the Java Virtual Machine</FONT><BR>
</FONT>
<!--END_MAIN_TITLES-->
<!--BEGIN_TITLE_UNDERBAR-->
<HR align="left" width="85%">
<!--END_TITLE_UNDERBAR-->
<!--BEGIN_RIGHT_MARGIN_TABLE_TAG-->
<TABLE CELLPADDING="3" CELLSPACING="0" BORDER="0" width="85%">
<TR>
<TD  valign="top" rowspan="100">
<!--END_RIGHT_MARGIN_TABLE_TAG-->
<!--BEGIN_MAIN_BODY-->
<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="CircleOfSquares.html">Previous</A>&nbsp;| 
<A href="SayingTomato.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->


<p>The <i>Three-Dimensional Array</i> applet, included below, demonstrates a Java virtual machine executing a sequence of bytecodes. This applet accompanies Chapter 15, &quot;Objects and Arrays,&quot; of <i>Inside the Java 2 Virtual Machine</i>.</p>

<p><center><applet CODE="ThreeDArray.class" ARCHIVE="JVMSims.jar"
CODEBASE="JVMSimulators" WIDTH=600 HEIGHT=370><b>For some reason, your browser won't let you view this way cool Java applet.</b></applet></center></p>

<p>The bytecode sequence in the simulation was generated by <code>javac</code> for the <code>initAnArray()</code> method of the class shown below: 
</p>
<pre>
// On CD-ROM in file opcodes/ex1/ThreeDTree.java
class ThreeDTree {

    static void initAnArray() {

        int[][][] threeD = new int[5][4][3];

        for (int i = 0; i < 5; ++i) {
            for (int j = 0; j < 4; ++j) {
                for (int k = 0; k < 3; ++k) {
                    threeD[i][j][k] = i + j + k;
                }
            }
        }
    }
}
</pre>
<p>The bytecodes generated by <code>javac</code> for <code>initAnArray()</code> are shown below: 
</p>
<pre>
 0 iconst_5      // Push constant int 5.
 1 iconst_4      // Push constant int 4.
 2 iconst_3      // Push constant int 3.
 3 multianewarray #2 dim #3 <Class [[[I>
                 // Create a new multi-dimensional array using
                 // constant pool entry #2 as the class (which
                 // is [[[I, an 3D array of ints) with a
                 // dimension of 3.
 7 astore_0      // Pop object ref into local variable 0:
                 // int threeD[][][] = new int[5][4][3];
 8 iconst_0      // Push constant int 0.
 9 istore_1      // Pop int into local variable 1: int i = 0;
10 goto 54       // Go to section of code that tests outer loop.
13 iconst_0      // Push constant int 0.
14 istore_2      // Pop int into local variable 2: int j = 0;
15 goto 46       // Go to section of code that tests middle loop.
18 iconst_0      // Push constant int 0.
19 istore_3      // Pop int into local variable 3: int k = 0;
20 goto 38       // Go to section of code that tests inner loop.
23 aload_0       // Push object ref from local variable 0.
24 iload_1       // Push int from local variable 1 (i).
25 aaload        // Pop index and arrayref, push object ref
                 // at arrayref[index] (gets threeD[i]).
26 iload_2       // Push int from local variable 2 (j).
27 aaload        // Pop index and arrayref, push object ref
                 // at arrayref[index] (gets threeD[i][j]).
28 iload_3       // Push int from local variable 3 (k).
                 // Now calculate the int that will be assigned
                 // to threeD[i][j][k]
29 iload_1       // Push int from local variable 1 (i).
30 iload_2       // Push int from local variable 2 (j).
31 iadd          // Pop two ints, add them, push int result (i + j).
32 iload_3       // Push int from local variable 3 (k).
33 iadd          // Pop two ints, add them, push int
                 // result (i + j + k).
34 iastore       // Pop value, index, and arrayref; assign
                 // arrayref[index] = value:
                 // threeD[i][j][k] = i + j + k;
35 iinc 3 1      // Increment by 1 the int in local variable 3: ++k;
38 iload_3       // Push int from local variable 3 (k).
39 iconst_3      // Push constant int 3.
40 if_icmplt 23  // Pop right and left ints, jump if left < right:
                 // for (...; k < 3;...)
43 iinc 2 1      // Increment by 1 the int in local variable 2: ++j;
46 iload_2       // Push int from local variable 2 (j).
47 iconst_4      // Push constant int 4.
48 if_icmplt 18  // Pop right and left ints, jump if left < right:
                 // for (...; j < 4;...)
51 iinc 1 1      // Increment by 1 the int in local variable 1: ++i;
54 iload_1       // Push int from local variable 1 (i).
55 iconst_5      // Push constant int 5.
56 if_icmplt 13  // Pop right and left ints, jump if left < right:
                 // for (...; i < 5;...)
59 return
</pre>
<p>The <code>initAnArray()</code> method merely allocates and initializes a three-dimensional array. This simulation demonstrates how the Java virtual machine handles multidimensional arrays. In response to the <code>multianewarray</code> instruction, which in this example requests the allocation of a three-dimensional array, the Java virtual machine creates a tree of
one-dimensional arrays. The reference returned by the <code>multianewarray</code> instruction refers to the base one-dimensional array in the tree. In the <code>initAnArray()</code> method, the base array has five components--<code>threeD[0]</code> through <code>threeD[4]</code>. Each component of the base array is itself a reference to a one-dimensional array of four components, accessed by <code>threeD[0][0]</code> through <code>threeD[4][3]</code>. The components of these five arrays are also references to arrays, each of which has three components. These components are <code>int</code>s, the elements of this multidimensional array, and they
and they are accessed by <CODE>threeD[0][0][0]</CODE> through <CODE>threeD[4][3][2]</CODE>. 
</p>
<p>In response to the <code>multianewarray</code> instruction in the <code>initAnArray()</code> method, the Java virtual machine creates one five-dimensional array of arrays, five four-dimensional arrays of arrays, and twenty three-dimensional arrays of <code>int</code>s. The Java virtual machine allocates these 26 arrays on the heap, initializes their components such that they form a tree, and returns the reference to the base array. 
</p>
<p>To assign an <code>int</code> value to an element of the three-dimensional array, the Java virtual machine uses <code>aaload</code> to get a component of the base array. Then the virtual machine uses <code>aaload</code> again on this component--which is itself an array of arrays--to get a component of the branch array. This component is a reference to a leaf array of <code>ints</code>. Finally the virtual machine uses <code>iastore</code> to assign an <code>int</code> value to the element of the leaf array. The Java virtual machine uses multiple one-dimensional array accesses to accomplish operations on multidimensional arrays. 
</p>
<p>To drive the <i>Three-Dimensional Array</i> simulation, use the Step, Reset, Run, and Stop buttons. Each time you press the Step button, the simulator will execute the instruction pointed to by the pc register. If you press the Run button, the simulation will continue with no further coaxing on your part until you press the Stop button. To start the simulation over, press the Reset button. For each step of the simulation, a panel at the bottom of the applet contains an explanation of what the next instruction will do. Happy clicking.
</p>

<p><HR WIDTH=500></p>
<p>
Click here to view a page of links to the <a href="sourcecode.html#jvmsim">source code</a> of the <i>Three Dimensional Array</i> applet.
</p>


<!--BEGIN_II_LINKS-->
<DIV id="links">
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interactive Illustrations</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/resources/">Resources Page</A>&nbsp;| 
<A href="http://www.artima.com/insidejvm/blurb.html">Order the Book</A>&nbsp;| 
<A href="CircleOfSquares.html">Previous</A>&nbsp;| 
<A href="SayingTomato.html">Next</A>&nbsp; 
</STRONG>
</FONT>
</CENTER>
</DIV>
<!--END_II_LINKS-->
<!--END_MAIN_BODY-->
<!--BEGIN_RIGHT_MARGIN_TABLE_CLOSE-->
</TD>
</TR>
</TABLE>
<!--END_RIGHT_MARGIN_TABLE_CLOSE-->
<!--BEGIN_FOOTER_SEPARATOR-->
<HR width="100%">
<!--END_FOOTER_SEPARATOR-->
<!--BEGIN_FOOTER-->
<TABLE width="100%">
<TR>
<TD align="left">
<FONT size="1" face="geneva, arial, sans-serif">
<!--REG_COPYRIGHT_LINE--><A href="copyright.html">Copyright</A> &copy; 1996-1999 Bill Venners. All Rights Reserved.
</FONT>
</TD>
</TR>
</TABLE>
<!--END_FOOTER-->
</body>
</html>
